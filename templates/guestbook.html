{% extends "base.html" %}
{% block title %}留言板{% endblock %}
{% block body %}
    <div id="content">
        <div class="post">
            <div class="messages">
                <ul>
                    {% for message in messages %}
                    <li>
                        <div class="m_name">姓名：{{ message.name }}</div>
                        <span class="m_time">留言时间：{{ message.date.strftime('%Y-%m-%d %H:%M:%S') if message.date else '不详' }}</span>
                        {% if g.user.is_authenticated() %}
                        {% if g.user.is_admin() %}
                        &emsp;<span class="m_ip">IP 地址：{{ message.ip }}</span>
                        {% endif %}
                        {% endif %}
                        <div class="m_content">内容：{{ message.content }}</div>
                        {% if g.user.is_authenticated() %}
                        <div class="m_delete">
                        {% if g.user.get_id() == message.uid or g.user.is_admin() %}
                        {% if message.visible != 'public' %}<a href="{{ url_for('unhide_message', id=message._id) }}">[设为可见]</a>{% else %}<a href="{{ url_for('hide_message', id=message._id) }}">[设为隐藏]</a>{% endif %}
                        <a href="{{ url_for('delete_message', id=message._id) }}">[删除]</a>
                        {% endif %}
                        </div>
                        {% endif %}
                    </li>
                    {% else %} {# else of for #}
                    <li style="text-align: center;"><em>无留言</em></li>
                    {% endfor %}
                </ul>
                <div class="pagination">
                    {% if cur_page > 1 %}
                    <a href="{{ url_for('show_message', page=cur_page-1) }}">上一页</a>
                    {% endif %}
                    {% if cur_page < total_pages %}
                    <a href="{{ url_for('show_message', page=cur_page+1) }}">下一页</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}